# T4女胎异常检测分析 v1.4

## 版本说明

v1.4是基于原v1.3版本的全面优化版本，专门针对题目要求进行了算法改进和功能增强。

## 主要特性

### 1. 改进的女胎筛选
- **多准则判断**：Y染色体浓度 + ZY值 + ZX值正常范围
- **聚类验证**：GMM聚类进行额外验证
- **稳健性**：至少满足2个准则才认定为女胎

### 2. 高级特征工程
- **40个工程化特征**：从原始15个增加到40个
- **染色体交互特征**：Z值交互项、综合评分
- **GC含量特征**：偏差、稳定性、变异性分析
- **异常检测特征**：单染色体异常标志、风险评分
- **特征选择**：自动选择最重要的26个特征

### 3. 多模型集成
- **模型对比**：逻辑回归、随机森林、梯度提升
- **自动选择**：基于交叉验证自动选择最佳模型
- **评分优化**：平衡F1分数和召回率的自定义评分

### 4. 双阈值策略
- **F1优化阈值**：平衡精确率和召回率
- **召回优先阈值**：确保高敏感度检测

### 5. 全面的结果输出
- **性能指标**：精确率、召回率、F1、ROC AUC
- **特征重要性**：模型系数 + 排列重要性
- **可视化图表**：PR曲线、ROC曲线、混淆矩阵、特征重要性
- **预测结果**：测试集详细预测输出

## 使用方法

### 基本运行
```bash
python3 t4_female_fetus_analysis.py
```

### 参数配置
```bash
python3 t4_female_fetus_analysis.py \
    --target_recall 0.90 \
    --test_size 0.2 \
    --seed 42 \
    --results_dir custom_output_path
```

### 参数说明
- `--target_recall`: 目标召回率 (默认: 0.90)
- `--test_size`: 测试集比例 (默认: 0.2)
- `--seed`: 随机种子 (默认: 42)
- `--results_dir`: 自定义结果输出目录

## 输出文件

### 模型文件
- `best_model.joblib` - 训练好的最佳模型

### 结果文件
- `comprehensive_metrics.json` - 详细性能指标
- `feature_importance.json` - 特征重要性分析
- `female_selection_stats.json` - 女胎筛选统计
- `model_comparison.json` - 模型对比结果
- `test_predictions_detailed.csv` - 测试集预测结果

### 可视化文件
- `comprehensive_evaluation.png` - 综合评估图表
- `feature_importance.png` - 特征重要性图表

## 性能指标

### 最新结果 (seed=42)
- **最佳模型**: LogisticRegression
- **ROC AUC**: 78.2%

#### F1优化阈值 (0.597)
- 精确率: 44.1%
- 召回率: 51.7%
- F1分数: 47.6%

#### 召回优先阈值 (0.329)
- 精确率: 19.2%
- 召回率: 86.2%
- F1分数: 31.4%

## 关键发现

### 最重要特征 (Top 5)
1. **GC21** - 21号染色体GC含量
2. **GC13** - 13号染色体GC含量  
3. **GC_range** - GC含量变异范围
4. **GC18** - 18号染色体GC含量
5. **GC_variance** - GC含量方差

### 生物学意义
- GC含量是染色体非整倍体的最重要指标
- 13、18、21号染色体异常检测符合临床需求
- 孕周和BMI等临床因素显著影响检测结果

## 应用建议

### 临床筛查
- **初步筛查**: 使用召回优先阈值，确保高敏感度
- **确诊检测**: 使用F1优化阈值，平衡精度和敏感度

### 技术特点
- **稳健性强**: 多准则女胎筛选和特征选择
- **可解释性好**: 特征重要性分析和决策透明
- **适应性强**: 双阈值策略适应不同应用场景

## 技术依赖

- Python 3.7+
- pandas, numpy, scikit-learn
- matplotlib, seaborn
- scipy, joblib

## 更新记录

### v1.4 (当前版本)
- 全面重构女胎筛选算法
- 增强特征工程 (40个特征)
- 多模型自动选择
- 双阈值策略
- 完整的可解释性分析

### v1.3
- 基础版本
- 单一逻辑回归模型
- 简单特征工程

## 联系方式

如有问题或建议，请参考项目文档或联系开发团队。
