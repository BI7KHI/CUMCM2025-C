# BMI分组可视化工具使用说明

## 功能概述

本工具用于对男性胎儿数据按照BMI进行分组，并生成Y染色体浓度与孕周的散点图，支持交互式调整BMI分区阈值。

## 文件说明

### 1. 交互式版本
- **文件**: `bmi_grouping_visualization.py`
- **特点**: 支持滑块交互式调整BMI分区阈值
- **依赖**: matplotlib, seaborn, scikit-learn, scipy

### 2. 简化版本
- **文件**: `bmi_grouping_simple.py`
- **特点**: 使用基础matplotlib，减少依赖
- **功能**: 生成静态图表和多种阈值对比

## 使用方法

### 方法1: 运行交互式版本
```bash
py bmi_grouping_visualization.py
```

**功能特点:**
- 实时调整BMI分区阈值
- 动态更新散点图和统计信息
- 支持重置到默认阈值
- 自动保存图表和数据

### 方法2: 运行简化版本
```bash
py bmi_grouping_simple.py
```

**功能特点:**
- 生成静态分析图表
- 多种BMI阈值对比
- 详细的统计信息输出
- 自动导出结果数据

## 输出文件

### 交互式版本输出
- `bmi_grouping_visualization.png` - 交互式图表截图
- `bmi_group_data.csv` - 分组后的数据
- `bmi_grouping_report.txt` - 详细分析报告

### 简化版本输出
- `bmi_grouping_analysis.png` - 综合分析图表
- `bmi_threshold_comparison.png` - 阈值对比图
- `bmi_grouping_results.csv` - 分组结果数据

## 图表说明

### 1. 主散点图
- **X轴**: 孕周 (周)
- **Y轴**: Y染色体浓度 (%)
- **颜色**: 不同BMI分组用不同颜色表示
- **趋势线**: 每个分组的线性趋势线

### 2. BMI分布直方图
- 显示BMI的整体分布
- 红色虚线表示分区阈值
- 帮助理解数据分布特征

### 3. 分组统计柱状图
- 对比各分组的Y染色体浓度和孕周均值
- 双Y轴设计，便于对比

### 4. 相关性热图
- 显示各分组内Y染色体与孕周的相关性
- 颜色深浅表示相关性强度

## BMI分组标准

### 默认分组阈值
- **偏瘦**: BMI < 18.5
- **正常**: 18.5 ≤ BMI < 25
- **超重**: 25 ≤ BMI < 30
- **肥胖I级**: 30 ≤ BMI < 35
- **肥胖II级**: BMI ≥ 35

### 自定义阈值
可以通过以下方式调整阈值：

#### 交互式版本
- 使用滑块实时调整
- 支持重置到默认值
- 实时查看调整效果

#### 简化版本
- 修改代码中的 `threshold_sets` 参数
- 生成多种阈值对比图

## 统计信息

### 各分组统计
- 样本数量
- BMI均值±标准差
- Y染色体浓度均值±标准差
- 孕周均值±标准差
- Y染色体与孕周相关性

### 总体统计
- 总样本数
- BMI范围
- Y染色体浓度范围
- 孕周范围

## 使用技巧

### 1. 数据准备
- 确保数据包含BMI、Y染色体浓度、孕周列
- 列名支持中英文自动识别
- 建议使用清洗后的数据

### 2. 阈值调整
- 根据数据分布特点调整阈值
- 观察不同阈值下的分组效果
- 选择合理的分组方案

### 3. 结果解读
- 关注各分组的样本数量分布
- 分析Y染色体与孕周的相关性
- 比较不同分组的特征差异

## 常见问题

### Q1: 无法加载数据
**解决方案:**
- 检查数据文件是否存在
- 确认文件格式支持 (Excel, CSV)
- 检查列名是否正确

### Q2: 图表显示异常
**解决方案:**
- 检查matplotlib中文字体设置
- 确认数据中无异常值
- 尝试使用简化版本

### Q3: 分组结果不合理
**解决方案:**
- 调整BMI分区阈值
- 检查数据质量
- 考虑数据预处理

## 扩展功能

### 1. 添加新的分组标准
修改 `bmi_labels` 和 `bmi_thresholds` 参数

### 2. 自定义颜色方案
修改 `colors` 列表

### 3. 添加新的统计指标
在 `_calculate_group_stats` 方法中添加

### 4. 导出更多格式
在 `export_results` 方法中添加

## 技术依赖

### 必需包
- pandas
- numpy
- matplotlib

### 可选包 (交互式版本)
- seaborn
- scikit-learn
- scipy

## 注意事项

1. 确保数据质量，异常值可能影响分析结果
2. BMI分组阈值应根据研究目的调整
3. 样本量过小的分组可能影响统计可靠性
4. 建议结合领域知识解释结果
